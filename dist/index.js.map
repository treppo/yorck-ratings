{"version":3,"sources":["../src/index.js"],"names":[],"mappings":"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","file":"index.js","sourcesContent":["(global => {\n  const proxify = url => 'http://crossorigin.me/' + url;\n  const unproxify = url => url.replace(/http:\\/\\/crossorigin.me\\//, '');\n\n  const fetch = (url) => {\n    if (!url) { return Promise.resolve() };\n\n    return new Promise((resolve, reject) => {\n      const xhr = new XMLHttpRequest();\n      xhr.onload = () => {\n        if (xhr.status == 200) { resolve(xhr.responseXML) }\n        else { reject(Error(xhr.statusText)) } };\n      xhr.onError = reject;\n      xhr.open(\"GET\", proxify(url));\n      xhr.responseType = \"document\";\n      xhr.overrideMimeType(\"text/html\");\n      xhr.send() }) };\n\n  async function yorckTitles() {\n    const url = \"http://www.yorck.de/mobile/filme\";\n    const page = await fetch(url);\n    const els = page.querySelectorAll('.films a');\n    const movieList = [].slice.call(els).map(_ => _.textContent);\n\n    return movieList\n  };\n\n  async function getMovieWithRating(yorckTitle) {\n    function MovieInfos(title = 'n/a', rating = 'n/a', url = '', ratingsCount = '') {\n      this.title = title;\n      this.rating = rating;\n      this.url = url;\n      this.ratingsCount = ratingsCount;\n    }\n\n    const imdbUrl = \"http://www.imdb.com\";\n    const toSearchUrl = movie => `${imdbUrl}/find?s=tt&q=${encodeURIComponent(movie)}`;\n\n    const getMovieUrl = page => {\n      const a = page.querySelector('.findList .result_text a');\n      if (!a) { return '' };\n      return imdbUrl + a.pathname\n    };\n    const movieInfos = page => {\n      const $ = (page, selector) => page.querySelector(selector) || { textContent: \"n/a\" };\n      const imdbTitle = $(page, '#overview-top .header').textContent;\n      const rating = $(page, '#overview-top .star-box-details strong').textContent;\n      const ratingsCount = $(page, '#overview-top .star-box-details > a').textContent;\n\n      return new MovieInfos(imdbTitle, rating, unproxify(page.URL), ratingsCount)\n    };\n\n    const searchPage = await fetch(toSearchUrl(yorckTitle));\n    const url = getMovieUrl(searchPage);\n    const moviePage = await fetch(url);\n\n    if (!moviePage) { return new MovieInfos() };\n    return movieInfos(moviePage);\n  };\n\n  const showOnPage = (yorckTitle, infos) => {\n    const moviesEl = document.getElementById(\"movies\");\n    moviesEl.innerHTML += `${yorckTitle} â€“ ${infos.title} <a href='${infos.url}'>${infos.rating} (${infos.ratingsCount})</a><br>`;\n  };\n\n  (async function() {\n    const isNotSneakPreview = title => !title.startsWith('Sneak');\n\n    (await yorckTitles())\n      .filter(isNotSneakPreview)\n      .map(t => [t, getMovieWithRating(t)])\n      .forEach(async function([title, i]){ showOnPage(title, await i); });\n  })()\n})(this);\n"]}